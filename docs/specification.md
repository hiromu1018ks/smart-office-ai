# [設計書] オールインワンAI事務アプリ「Smart Office AI」

| 項目                   | 内容                                                        |
| :--------------------- | :---------------------------------------------------------- |
| ドキュメントバージョン | 0.3                                                         |
| 作成日                 | 2024年XX月XX日                                              |
| 最終更新日             | 2024年XX月XX日                                              |
| ステータス             | 要件定義/基本設計                                           |
| 変更履歴               | v0.2→v0.3: 個人開発向けに技術スタックを無料/OSSベースに変更 |

---

## 1. システム概要

### 1.1 コンセプト

「社内のあらゆる情報と業務を一箇所に集約し、AIが自動的に整理・実行・提案する、次世代のデジタルオフィス基盤」

### 1.2 開発方針

| 方針   | 内容                                           |
| :----- | :--------------------------------------------- |
| 機能   | エンタープライズ級のフル機能を実装             |
| 費用   | 可能な限り無料/OSSで構成、有料サービスは最小限 |
| 運用   | セルフホスト（自宅サーバー/VPS）               |
| 拡張性 | 将来的なマルチテナント対応を考慮した設計       |

### 1.3 ターゲットユーザー

#### 想定利用規模

| 区分             | ユーザー数 | 備考                       |
| :--------------- | :--------- | :------------------------- |
| 初期（個人利用） | 1〜5名     | 開発者本人 + 家族・知人    |
| 拡張時           | 5〜50名    | 小規模チーム・組織での利用 |
| 将来目標         | 50〜300名  | 中小企業への展開           |

#### ユーザーペルソナ

| ペルソナ       | 役割           | 主な利用シーン                       | 期待する価値                           |
| :------------- | :------------- | :----------------------------------- | :------------------------------------- |
| 経営者・管理職 | 意思決定者     | 経営数値の確認、承認処理             | 現状把握の迅速化、判断材料の即時取得   |
| 営業担当       | 顧客対応       | 顧客情報検索、提案書作成             | 移動中の情報アクセス、資料作成時間短縮 |
| 総務・人事担当 | バックオフィス | 規程類の問い合わせ対応、申請処理     | 定型質問への自動対応、書類作成効率化   |
| 一般社員       | 業務遂行者     | 日常のコミュニケーション、タスク管理 | 情報検索時間の削減、作業の自動化       |

### 1.4 解決する課題

| 課題             | 現状                                                                                 | 本システムによる解決         |
| :--------------- | :----------------------------------------------------------------------------------- | :--------------------------- |
| ツールの複雑化   | チャット、スケジュール、タスク、ファイル保存などでツールが分散し、情報の断片化が発生 | 単一プラットフォームへの統合 |
| 事務作業の属人化 | 議事録作成、メール返信、資料作成が特定の人に依存                                     | AIによる作業支援と標準化     |
| ナレッジの消失   | 過去の文書やチャット履歴がブラックボックス化                                         | RAGによる自然言語検索の実現  |
| 学習コストの高さ | 複数ツールの習得が必要                                                               | 統一UIとAIによる操作支援     |
| 高額なSaaS費用   | 1人あたり月額数千円のツールが複数                                                    | セルフホストによるコスト削減 |

### 1.5 主な特徴

| 特徴         | 説明                                                                          |
| :----------- | :---------------------------------------------------------------------------- |
| All-in-One   | チャット、カレンダー、タスク、ファイル管理、CRM（簡易版）、ワークフローを統合 |
| AI Native    | あらゆる操作にAIが介入し、テキスト入力や要約、スケジュール調整を支援          |
| 社内RAG      | 過去のチャットや添付ファイルをAIが理解し、自然言語で回答可能                  |
| セルフホスト | 全てOSS/無料サービスで構成、データは完全に自分の管理下                        |
| 低コスト     | 月額1,000〜3,000円程度での運用を目標                                          |

### 1.6 競合分析と差別化

#### 競合サービス比較

| 観点            | Microsoft 365 + Copilot | Google Workspace + Gemini | Notion AI      | **本システム**    |
| :-------------- | :---------------------- | :------------------------ | :------------- | :---------------- |
| 月額費用（5人） | ¥22,500〜               | ¥11,200〜                 | ¥8,250〜       | **¥1,000〜3,000** |
| データ所有権    | クラウド事業者          | クラウド事業者            | クラウド事業者 | **完全自己管理**  |
| カスタマイズ性  | △                       | △                         | ○              | **◎**             |
| オフライン対応  | △                       | ×                         | △              | **○**             |
| AI機能の統合度  | 高                      | 中                        | 中             | **高**            |

#### 差別化ポイント

1. **圧倒的な低コスト**: SaaS費用をほぼゼロに
2. **データ主権**: 機密データを外部に出さない
3. **無制限カスタマイズ**: 自分の業務に完全最適化
4. **ベンダーロックインなし**: いつでも移行可能

---

## 2. 機能要件一覧

本アプリは以下の6つのモジュールで構成されます。

### 2.1 コミュニケーションモジュール（チャット）

| 機能                | 説明                                                   | 優先度 |
| :------------------ | :----------------------------------------------------- | :----- |
| グループチャット/DM | プロジェクトごとの部屋作成、1対1のダイレクトメッセージ | 必須   |
| AIアシスタント常駐  | チャット画面にAIが参加し、要約・抽出・翻訳等を実行     | 必須   |
| スレッド機能        | 話題ごとにスレッドを分岐                               | 必須   |
| リアクション        | 絵文字によるリアクション                               | 必須   |
| メンション          | @ユーザー名での通知                                    | 必須   |
| ファイル添付        | 画像、ドキュメントの共有                               | 必須   |
| 翻訳・校正          | 入力中の文章を自動で校正、または多言語翻訳             | 推奨   |
| 検索                | 過去メッセージの全文検索                               | 必須   |
| 音声・ビデオ通話    | 1対1およびグループ通話                                 | 将来   |

### 2.2 スケジュール・タスクモジュール

| 機能               | 説明                                                    | 優先度 |
| :----------------- | :------------------------------------------------------ | :----- |
| カレンダー共有     | チームメンバーの空き時間視覚化                          | 必須   |
| 外部カレンダー連携 | Google Calendar / Outlook との双方向同期（CalDAV/iCal） | 必須   |
| AI予約調整         | 自然言語での日程調整指示に対応                          | 必須   |
| タスク管理         | カンバン形式でのタスク管理                              | 必須   |
| タスク自動生成     | チャット内容からAIがタスクを抽出・作成                  | 推奨   |
| 繰り返しタスク     | 日次/週次/月次の定期タスク                              | 必須   |
| リマインダー       | 期限前の自動通知                                        | 必須   |
| ガントチャート     | プロジェクトのタイムライン表示                          | 将来   |

### 2.3 ナレッジベース・ファイル管理

| 機能           | 説明                                                  | 優先度 |
| :------------- | :---------------------------------------------------- | :----- |
| ドライブ機能   | ファイルのアップロード、閲覧、フォルダ整理            | 必須   |
| バージョン管理 | ファイルの変更履歴保持                                | 必須   |
| AI要約・Q&A    | アップロードされたドキュメントへの自然言語質問（RAG） | 必須   |
| 自動タグ付け   | ファイル内容をAIが分析し、自動でタグを付与            | 推奨   |
| 全文検索       | ファイル内容を含めた横断検索                          | 必須   |
| プレビュー     | PDF、Office、画像、動画のインライン表示               | 必須   |
| OCR            | 画像・スキャンPDFのテキスト抽出                       | 推奨   |
| Wiki機能       | Markdown形式のドキュメント作成、相互リンク            | 推奨   |

#### 対応ファイル形式

| カテゴリ     | 形式                                | AI処理対応                  |
| :----------- | :---------------------------------- | :-------------------------- |
| ドキュメント | PDF, DOCX, XLSX, PPTX, TXT, MD, CSV | ○                           |
| 画像         | JPG, PNG, GIF, WEBP, SVG            | ○（OCR/画像認識）           |
| 動画         | MP4, MOV, WebM                      | △（メタデータ、サムネイル） |
| 音声         | MP3, WAV, M4A, OGG                  | ○（Whisper文字起こし）      |

### 2.4 簡易CRM/顧客管理

| 機能               | 説明                                               | 優先度 |
| :----------------- | :------------------------------------------------- | :----- |
| 顧客カード作成     | 顧客情報の登録・管理（会社名、担当者、連絡先）     | 推奨   |
| AI自動抽出         | メールやチャットから顧客情報を自動抽出             | 推奨   |
| 活動履歴の紐付け   | 顧客に関するチャット・ファイル・タスクの自動紐付け | 推奨   |
| カスタムフィールド | 業種に応じた項目追加                               | 推奨   |
| 商談管理           | パイプライン管理（ステージ、金額、確度）           | 将来   |
| レポート           | 顧客別売上、活動量の可視化                         | 将来   |

### 2.5 経費・承認ワークフロー

| 機能             | 説明                                             | 優先度 |
| :--------------- | :----------------------------------------------- | :----- |
| 申請フォーム     | 経費精算、休暇申請、稟議等の電子フォーム         | 推奨   |
| AI読み取り       | レシート画像からの自動入力（日付、金額、店舗名） | 推奨   |
| 承認ルート       | 申請内容・金額に基づく承認者のルーティング       | 推奨   |
| 承認履歴         | 承認/差戻しの履歴管理                            | 推奨   |
| 通知             | 承認依頼・完了の通知                             | 推奨   |
| ワークフロー設計 | ノーコードでの承認フロー設計                     | 将来   |

### 2.6 AI機能（横断）

| 機能             | 説明                               | 優先度 |
| :--------------- | :--------------------------------- | :----- |
| 統合検索         | 全モジュール横断の自然言語検索     | 必須   |
| チャットボット   | 対話形式でのAI操作                 | 必須   |
| 文書生成         | メール、報告書、議事録の下書き作成 | 必須   |
| 要約             | 長文の要点抽出                     | 必須   |
| 翻訳             | 多言語翻訳                         | 推奨   |
| コマンドパレット | Cmd+Kで呼び出すAIアクション        | 推奨   |
| 音声入力         | 音声からのテキスト入力             | 将来   |

---

## 3. 非機能要件

### 3.1 可用性

| 項目     | 要件                                          |
| :------- | :-------------------------------------------- |
| SLA目標  | 自宅サーバー: ベストエフォート / VPS: 99%程度 |
| 計画停止 | 随時（事前通知推奨）                          |
| 障害復旧 | 手動対応（4時間以内を目標）                   |

### 3.2 性能

| 項目                 | 要件                                                     |
| :------------------- | :------------------------------------------------------- |
| 同時接続数           | 最大50ユーザー                                           |
| API応答時間          | 95パーセンタイルで500ms以内（AI処理除く）                |
| AI応答時間           | 簡易応答: 3秒以内、RAG検索: 10秒以内、文書生成: 30秒以内 |
| ファイルアップロード | 1ファイル最大500MB                                       |
| ストレージ           | 初期50GB、最大1TB程度を想定                              |

### 3.3 スケーラビリティ

| 項目         | 要件                                                                     |
| :----------- | :----------------------------------------------------------------------- |
| 初期想定     | 1〜5ユーザー、10GBデータ                                                 |
| 1年後目標    | 10〜50ユーザー、100GBデータ                                              |
| スケール方式 | 垂直スケーリング（サーバースペック増強）を基本とし、必要に応じて水平分割 |

### 3.4 バックアップ・災害復旧

| 項目                | 要件                                         |
| :------------------ | :------------------------------------------- |
| RPO（目標復旧時点） | 24時間以内                                   |
| RTO（目標復旧時間） | 8時間以内                                    |
| バックアップ頻度    | DB: 日次 / ファイル: 日次増分                |
| 保持期間            | 30日間                                       |
| バックアップ先      | ローカル + リモート（Backblaze B2 / rclone） |

### 3.5 セキュリティ

| 項目         | 要件                                        |
| :----------- | :------------------------------------------ |
| 認証         | ID/パスワード + TOTP（2要素認証）           |
| 通信         | HTTPS必須（Let's Encrypt）                  |
| データ保存   | ローカルディスク、暗号化オプション          |
| アクセス制限 | Tailscale / VPN経由を推奨、IP制限オプション |
| 監査ログ     | 全操作ログを90日間保持                      |

### 3.6 保守性

| 項目         | 要件                                   |
| :----------- | :------------------------------------- |
| デプロイ     | Docker Compose一発起動                 |
| 更新         | git pull + docker-compose up で更新    |
| ログ         | 構造化ログ（JSON）、ローテーション設定 |
| 監視         | Uptime Kuma等でヘルスチェック          |
| ドキュメント | READMEとセットアップガイド整備         |

---

## 4. AI機能設計詳細

### 4.1 AIモデル選定

#### 無料/低コスト優先の選定方針

| 用途           | 第1候補（無料）                               | 第2候補（低コスト）           | 選定理由                      |
| :------------- | :-------------------------------------------- | :---------------------------- | :---------------------------- |
| メイン処理     | Ollama (Llama 3.1 70B / Qwen2.5 72B)          | Claude API (Sonnet)           | ローカル優先、品質必要時はAPI |
| 軽量処理       | Ollama (Llama 3.1 8B / Gemma2 9B)             | -                             | 分類、要約等                  |
| 埋め込み       | Ollama (nomic-embed-text / mxbai-embed-large) | OpenAI text-embedding-3-small | ローカル優先                  |
| 音声文字起こし | Whisper.cpp (ローカル)                        | -                             | 完全無料                      |
| OCR            | Tesseract + EasyOCR                           | -                             | OSS、日本語対応               |
| 画像認識       | Ollama (LLaVA)                                | Claude API (Vision)           | マルチモーダル対応            |

#### ローカルLLM推奨スペック

| モデルサイズ | 必要VRAM | 推奨GPU         | 備考                   |
| :----------- | :------- | :-------------- | :--------------------- |
| 7-8B         | 8GB      | RTX 3060 12GB   | 基本的な処理に十分     |
| 13B          | 10GB     | RTX 3080 10GB   | バランス良好           |
| 70B (量子化) | 24-48GB  | RTX 3090 / 4090 | 高品質、要ハイスペック |
| CPU推論      | -        | -               | 速度は遅いが動作可能   |

#### コスト試算（月間）

| 利用パターン       | ローカルLLMのみ | ローカル + API併用 |
| :----------------- | :-------------- | :----------------- |
| ライト（1日10回）  | ¥0 + 電気代     | ¥500程度           |
| ミドル（1日30回）  | ¥0 + 電気代     | ¥1,500程度         |
| ヘビー（1日100回） | ¥0 + 電気代     | ¥3,000程度         |

### 4.2 RAG設計

#### Vector Database選定

| 候補                  | コスト               | 選定       | 理由                       |
| :-------------------- | :------------------- | :--------- | :------------------------- |
| PostgreSQL + pgvector | 無料                 | **◎ 採用** | メインDBと統合、実績あり   |
| SQLite + sqlite-vss   | 無料                 | ○ 代替     | より軽量な構成が必要な場合 |
| Qdrant                | 無料（セルフホスト） | ○ 将来検討 | 専用Vector DB、高性能      |
| Chroma                | 無料                 | △          | Python限定、永続化に難あり |

#### インデックス設計

| 対象               | チャンク方式   | オーバーラップ | 備考                       |
| :----------------- | :------------- | :------------- | :------------------------- |
| チャットメッセージ | メッセージ単位 | なし           | スレッド文脈は検索時に付与 |
| ドキュメント       | 500トークン    | 50トークン     | セクション境界を考慮       |
| 長文ドキュメント   | 1000トークン   | 100トークン    | 契約書、マニュアル等       |
| Wiki/メモ          | 段落単位       | なし           | Markdown見出しで分割       |

### 4.3 AI処理フロー

```
[ユーザー入力]
    ↓
[入力サニタイズ]
    ↓
[意図分類 (ローカルLLM)]
    ↓
[処理分岐]
    ├─→ 単純な質問 → [ローカルLLM] → [応答]
    ├─→ RAG検索 → [Vector DB] → [コンテキスト構築] → [ローカルLLM] → [応答]
    └─→ 複雑な生成 → [品質判定] → [ローカル or API] → [応答]
```

### 4.4 主なユースケース

| シーン       | ユーザー操作                   | AIのアクション                          | 使用モデル              |
| :----------- | :----------------------------- | :-------------------------------------- | :---------------------- |
| 会議後       | 議事録テキストを貼り付け       | 要約、ToDoタスク抽出、担当者アサイン    | ローカルLLM             |
| 資料作成     | 「前回の提案書をベースに作成」 | RAG検索→テンプレート適用→ドラフト作成   | ローカルLLM + RAG       |
| 情報検索     | 「有給休暇の規定を教えて」     | 就業規則PDFを参照し回答                 | ローカルLLM + RAG       |
| メール返信   | 「丁寧にお断りして」           | 文脈に合わせた返信案を生成              | ローカルLLM or API      |
| 日程調整     | 「来週、田中さんと打ち合わせ」 | 空き時間検索、候補提示                  | ローカルLLM             |
| レシート処理 | レシート画像をアップロード     | OCR→金額・日付抽出→申請フォーム自動入力 | Tesseract + ローカルLLM |

### 4.5 エラーハンドリング

| エラー            | 対応                                         |
| :---------------- | :------------------------------------------- |
| ローカルLLM過負荷 | キューイング、同時実行数制限                 |
| API接続失敗       | ローカルLLMへフォールバック                  |
| タイムアウト      | 60秒でタイムアウト、リトライ1回              |
| 回答不能          | 「見つかりませんでした」+ 検索キーワード提案 |
| 幻覚検知          | RAG結果との照合、ソース表示必須              |

### 4.6 AI利用の透明性

| 方針         | 実装                                                   |
| :----------- | :----------------------------------------------------- |
| AI生成の明示 | AI生成コンテンツには「✨ AI生成」ラベルを表示          |
| ソース表示   | RAG回答時は参照した文書へのリンクを併記                |
| モデル表示   | 使用したモデル（ローカル/API）を表示（設定で非表示可） |
| 編集履歴     | AI生成→人間編集の履歴を保持                            |

---

## 5. セキュリティ設計

### 5.1 認証・認可

#### 認証方式

| 方式          | 対応 | 備考                       |
| :------------ | :--- | :------------------------- |
| ID/パスワード | ○    | 標準提供                   |
| TOTP (2FA)    | ○    | Google Authenticator等対応 |
| LDAP/AD連携   | 将来 | 組織利用時                 |
| OIDC          | 将来 | Google/Microsoft連携       |

#### パスワードポリシー

| 項目         | 要件                                      |
| :----------- | :---------------------------------------- |
| 最小文字数   | 12文字以上                                |
| 複雑性       | 大文字・小文字・数字・記号のうち3種類以上 |
| 有効期限     | 無期限（変更推奨通知あり）                |
| ロックアウト | 5回連続失敗で30分ロック                   |

#### セッション管理

| 項目               | 要件                                |
| :----------------- | :---------------------------------- |
| セッション有効期限 | 7日間（アクティブ時は延長）         |
| 同時セッション     | 制限なし（管理画面で確認可能）      |
| リモートログアウト | 管理者/本人による強制ログアウト可能 |

### 5.2 データ分類と権限

#### 権限モデル

```
組織 (Organization)
  └── チーム (Team)
       └── チャンネル (Channel) ← メンバー/管理者
       └── フォルダ (Folder) ← 閲覧/編集/管理
       └── プロジェクト (Project) ← メンバー/管理者
```

#### ロール定義

| ロール   | 権限                                      |
| :------- | :---------------------------------------- |
| オーナー | 全権限、組織設定、メンバー管理            |
| 管理者   | チーム/プロジェクト管理、メンバー招待     |
| メンバー | 通常利用、自分のコンテンツ管理            |
| ゲスト   | 招待されたチャンネル/フォルダのみアクセス |

### 5.3 AIセキュリティ

| 対策                           | 実装                                     |
| :----------------------------- | :--------------------------------------- |
| プロンプトインジェクション対策 | 入力サニタイズ、システムプロンプト保護   |
| 機密情報フィルタリング         | 出力時の機密パターン検出                 |
| アクセス権限継承               | ユーザーが閲覧できない情報はAIも参照不可 |
| ログ記録                       | AI入出力のログ記録（機密情報はマスク）   |

### 5.4 通信・保存時のセキュリティ

| 対象                   | 方式                             |
| :--------------------- | :------------------------------- |
| 通信                   | TLS 1.2以上必須（Let's Encrypt） |
| 保存データ（DB）       | オプションで暗号化（LUKS等）     |
| 保存データ（ファイル） | オプションで暗号化               |
| バックアップ           | 暗号化推奨（GPG / age）          |

---

## 6. システム構成

### 6.1 アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────┐
│                        クライアント                          │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐              │
│  │ ブラウザ   │  │ モバイル   │  │ デスクトップ│              │
│  └─────┬─────┘  └─────┬─────┘  └─────┬─────┘              │
└────────┼──────────────┼──────────────┼──────────────────────┘
         │              │              │
         └──────────────┼──────────────┘
                        │ HTTPS (Tailscale / VPN / Direct)
                        ▼
┌─────────────────────────────────────────────────────────────┐
│                   自宅サーバー / VPS                         │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                   Docker Compose                       │ │
│  │                                                        │ │
│  │  ┌────────────────────────────────────────────────┐   │ │
│  │  │              Caddy (リバースプロキシ)           │   │ │
│  │  │         - HTTPS終端 (Let's Encrypt)            │   │ │
│  │  │         - WebSocket対応                         │   │ │
│  │  └──────────────────┬─────────────────────────────┘   │ │
│  │                     │                                  │ │
│  │  ┌──────────────────▼─────────────────────────────┐   │ │
│  │  │                App Server                       │   │ │
│  │  │            Python (FastAPI)                     │   │ │
│  │  │  - REST API                                     │   │ │
│  │  │  - WebSocket (リアルタイム通信)                 │   │ │
│  │  │  - Background Worker (Celery / ARQ)            │   │ │
│  │  └───┬─────────────────┬─────────────────┬────────┘   │ │
│  │      │                 │                 │            │ │
│  │      ▼                 ▼                 ▼            │ │
│  │ ┌─────────┐     ┌───────────┐     ┌───────────┐      │ │
│  │ │PostgreSQL│     │   Redis   │     │  Ollama   │      │ │
│  │ │+pgvector │     │ (キャッシュ│     │(ローカル  │      │ │
│  │ │          │     │  キュー)  │     │  LLM)     │      │ │
│  │ └─────────┘     └───────────┘     └───────────┘      │ │
│  │      │                                                │ │
│  │      ▼                                                │ │
│  │ ┌─────────┐     ┌───────────┐                        │ │
│  │ │ ファイル │     │ Whisper   │                        │ │
│  │ │ストレージ│     │ (音声認識)│                        │ │
│  │ └─────────┘     └───────────┘                        │ │
│  │                                                        │ │
│  └────────────────────────────────────────────────────────┘ │
│                            │                                │
│                            ▼ (オプション・必要時のみ)        │
│                    ┌───────────────┐                        │
│                    │ Claude API /  │                        │
│                    │ OpenAI API    │                        │
│                    └───────────────┘                        │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 技術スタック（全て無料/OSS）

| レイヤー          | 技術                     | ライセンス/コスト         | 選定理由                             |
| :---------------- | :----------------------- | :------------------------ | :----------------------------------- |
| フロントエンド    | React 18 + TypeScript    | MIT / 無料                | エコシステム充実                     |
| UIフレームワーク  | Tailwind CSS + Magic UI  | MIT / 無料                | 高速開発、アニメーション付きモダンUI |
| エディタ          | TipTap (ProseMirror)     | MIT / 無料                | リッチテキスト、Markdown対応         |
| バックエンド      | Python 3.12 + FastAPI    | MIT / 無料                | AI処理との親和性                     |
| リアルタイム通信  | WebSocket (FastAPI)      | -                         | チャット、通知                       |
| 非同期処理        | ARQ (Redis-based)        | MIT / 無料                | 軽量、Celeryより簡単                 |
| データベース      | PostgreSQL 16 + pgvector | PostgreSQL License / 無料 | 実績、Vector検索統合                 |
| キャッシュ/キュー | Redis (Valkey)           | BSD / 無料                | 汎用性高い                           |
| ファイル保存      | ローカルファイルシステム | -                         | シンプル、S3互換も可                 |
| ローカルLLM       | Ollama                   | MIT / 無料                | 簡単セットアップ                     |
| 音声認識          | Whisper.cpp              | MIT / 無料                | 高精度、ローカル動作                 |
| OCR               | Tesseract + EasyOCR      | Apache 2.0 / 無料         | 日本語対応                           |
| リバースプロキシ  | Caddy                    | Apache 2.0 / 無料         | 自動HTTPS                            |
| 認証              | 自前実装 (JWT + TOTP)    | -                         | シンプル、依存少                     |
| コンテナ          | Docker Compose           | Apache 2.0 / 無料         | 一発起動                             |
| 監視              | Uptime Kuma              | MIT / 無料                | セルフホスト監視                     |
| ログ              | Loki + Grafana           | AGPLv3 / 無料             | ログ集約（オプション）               |

### 6.3 外部連携（無料枠活用）

| 連携先          | 方式          | 用途                   | 費用                    |
| :-------------- | :------------ | :--------------------- | :---------------------- |
| Google Calendar | CalDAV / iCal | カレンダー同期         | 無料                    |
| Backblaze B2    | S3互換API     | バックアップ           | 10GB無料、以降$0.005/GB |
| Cloudflare      | DNS           | ドメイン管理、DDoS対策 | 無料プラン              |
| Let's Encrypt   | ACME          | SSL証明書              | 無料                    |
| Tailscale       | WireGuard     | セキュアアクセス       | 100デバイス無料         |

### 6.4 ディレクトリ構成

```
smart-office-ai/
├── docker-compose.yml
├── docker-compose.override.yml    # 開発用設定
├── .env.example
├── Makefile                       # 便利コマンド
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── ui/               # Magic UI
│   │   │   ├── chat/
│   │   │   ├── calendar/
│   │   │   ├── tasks/
│   │   │   ├── files/
│   │   │   ├── crm/
│   │   │   └── workflow/
│   │   ├── pages/
│   │   ├── hooks/
│   │   ├── lib/
│   │   └── stores/               # Zustand
│   ├── package.json
│   └── Dockerfile
│
├── backend/
│   ├── app/
│   │   ├── api/
│   │   │   ├── v1/
│   │   │   │   ├── auth.py
│   │   │   │   ├── chat.py
│   │   │   │   ├── calendar.py
│   │   │   │   ├── tasks.py
│   │   │   │   ├── files.py
│   │   │   │   ├── crm.py
│   │   │   │   ├── workflow.py
│   │   │   │   └── ai.py
│   │   │   └── websocket.py
│   │   ├── models/               # SQLAlchemy
│   │   ├── schemas/              # Pydantic
│   │   ├── services/
│   │   │   ├── ai/
│   │   │   │   ├── llm_service.py
│   │   │   │   ├── rag_service.py
│   │   │   │   ├── embedding_service.py
│   │   │   │   └── ocr_service.py
│   │   │   ├── chat_service.py
│   │   │   ├── file_service.py
│   │   │   └── notification_service.py
│   │   ├── core/
│   │   │   ├── config.py
│   │   │   ├── security.py
│   │   │   └── database.py
│   │   ├── workers/              # 非同期タスク
│   │   └── main.py
│   ├── alembic/                  # マイグレーション
│   ├── tests/
│   ├── requirements.txt
│   └── Dockerfile
│
├── ollama/
│   └── Modelfile                 # カスタムモデル設定
│
├── caddy/
│   └── Caddyfile
│
├── data/                         # Dockerボリューム
│   ├── postgres/
│   ├── redis/
│   ├── files/
│   ├── ollama/
│   └── backups/
│
├── scripts/
│   ├── backup.sh
│   ├── restore.sh
│   └── setup.sh
│
└── docs/
    ├── README.md
    ├── SETUP.md
    ├── API.md
    └── DEVELOPMENT.md
```

---

## 7. 画面設計

### 7.1 レイアウト構成

```
┌─────────────────────────────────────────────────────────────────┐
│  [≡]  Smart Office AI    [🔍 検索... Cmd+K]     [🔔] [👤] [⚙️] │
├─────────┬───────────────────────────────────────┬───────────────┤
│         │                                       │               │
│  サイド │         メインワークスペース           │   AIパネル    │
│  バー   │                                       │   (トグル)    │
│         │  ┌─────────────────────────────────┐ │               │
│ ▼ ホーム │  │                                 │ │  [💬 AI]     │
│   ダッシュ│  │   各モジュールのコンテンツ      │ │               │
│         │  │                                 │ │  User:       │
│ ▼ チャット│  │   - チャット画面                │ │  〇〇を検索  │
│   # general│ │   - カレンダー                  │ │               │
│   # project│ │   - タスクボード                │ │  AI:         │
│         │  │   - ファイル一覧                │ │  見つかった  │
│ ▼ カレンダー│ │   - CRM                        │ │  のは...     │
│         │  │   - 申請・承認                  │ │               │
│ ▼ タスク │  │                                 │ │  [入力欄]    │
│   📋 MyTask│ │                                 │ │               │
│         │  └─────────────────────────────────┘ │  [📎][🎤][↑] │
│ ▼ ファイル│                                     │               │
│   📁 Documents│                                 │               │
│         │                                       │               │
│ ▼ CRM   │                                       │               │
│         │                                       │               │
│ ▼ 申請  │                                       │               │
│         │                                       │               │
├─────────┴───────────────────────────────────────┴───────────────┤
│  [✨ AIに聞く Cmd+J]                           [?] ヘルプ       │
└─────────────────────────────────────────────────────────────────┘
```

### 7.2 主要画面一覧

| 画面           | 説明                                                                 |
| :------------- | :------------------------------------------------------------------- |
| ダッシュボード | 今日の予定、未完了タスク、最近の活動、通知を一覧表示                 |
| チャット       | Slack風のチャンネルリスト + メッセージ表示 + スレッド                |
| カレンダー     | 月/週/日ビュー、ドラッグ&ドロップで予定作成                          |
| タスクボード   | カンバン形式（ステータス別）、リスト形式切替可                       |
| ファイル一覧   | グリッド/リスト切替、プレビューパネル、ドラッグ&ドロップアップロード |
| Wiki/ノート    | Notion風のブロックエディタ、ページツリー                             |
| CRM            | 顧客一覧、顧客詳細カード、活動タイムライン                           |
| 申請・承認     | 申請フォーム、承認待ち一覧、履歴                                     |
| 設定           | プロフィール、通知、API設定、組織管理                                |
| AI チャット    | サイドパネルまたはモーダルで表示                                     |

### 7.3 UI/UX方針

| 方針                 | 実装                                             |
| :------------------- | :----------------------------------------------- |
| キーボードファースト | Cmd+K（検索）, Cmd+J（AI）, Cmd+N（新規作成）等  |
| ダークモード         | システム設定連動 + 手動切替                      |
| レスポンシブ         | デスクトップ優先、タブレット対応、モバイル最低限 |
| PWA                  | オフライン対応（読み取り専用）、ホーム追加       |
| アクセシビリティ     | キーボードナビゲーション、スクリーンリーダー考慮 |

---

## 8. 開発ロードマップ

### Phase 1: 基盤構築（3週間）

| 週  | 内容       | 成果物                               |
| :-- | :--------- | :----------------------------------- |
| 1   | 環境構築   | Docker Compose、DB設計、認証基盤     |
| 2   | 基本UI     | レイアウト、ナビゲーション、設定画面 |
| 3   | Ollama連携 | ローカルLLM統合、基本チャットUI      |

**完了条件**: ログインしてAIとチャットできる

### Phase 2: コア機能 - チャット & ファイル（4週間）

| 週  | 内容               | 成果物                                     |
| :-- | :----------------- | :----------------------------------------- |
| 4-5 | チャット機能       | チャンネル、DM、メッセージ、WebSocket      |
| 6-7 | ファイル管理 + RAG | アップロード、プレビュー、Vector化、AI Q&A |

**完了条件**: チームでチャットし、ファイルをAIに質問できる

### Phase 3: 生産性機能（4週間）

| 週    | 内容                | 成果物                               |
| :---- | :------------------ | :----------------------------------- |
| 8-9   | カレンダー & タスク | スケジュール管理、タスクボード、連携 |
| 10-11 | Wiki & 検索強化     | ブロックエディタ、全文検索、横断検索 |

**完了条件**: 日常業務で使える状態

### Phase 4: 業務アプリ（4週間）

| 週    | 内容         | 成果物                         |
| :---- | :----------- | :----------------------------- |
| 12-13 | CRM          | 顧客管理、活動履歴、AI抽出     |
| 14-15 | ワークフロー | 申請フォーム、承認ルート、通知 |

**完了条件**: ビジネス利用可能な状態

### Phase 5: 安定化 & 拡張（継続）

- パフォーマンス最適化
- モバイル対応強化
- 外部連携拡充
- ドキュメント整備

---

## 9. コスト試算

### 9.1 初期費用

| 項目                    | 費用             | 備考                            |
| :---------------------- | :--------------- | :------------------------------ |
| ドメイン                | ¥1,500/年        | オプション（Tailscaleなら不要） |
| GPU（所有している場合） | ¥0               | 既存機材流用                    |
| GPU（購入する場合）     | ¥50,000〜150,000 | RTX 3060〜4090                  |
| **合計**                | **¥0〜150,000**  |                                 |

### 9.2 月額ランニングコスト

| 構成                           | サーバー       | AI            | バックアップ | 合計              |
| :----------------------------- | :------------- | :------------ | :----------- | :---------------- |
| 自宅サーバー（GPU有）          | ¥500（電気代） | ¥0〜500       | ¥0           | **¥500〜1,000**   |
| 自宅サーバー（GPU無、CPU推論） | ¥300           | ¥0〜1,000     | ¥0           | **¥300〜1,300**   |
| VPS + ローカルGPU              | ¥1,000         | ¥0〜500       | ¥100         | **¥1,100〜1,600** |
| VPS のみ（API依存）            | ¥1,500         | ¥1,500〜3,000 | ¥100         | **¥3,100〜4,600** |

### 9.3 競合サービスとのコスト比較（5ユーザー想定）

| サービス                           | 月額            | 年額               |
| :--------------------------------- | :-------------- | :----------------- |
| Microsoft 365 E3 + Copilot         | ¥22,500         | ¥270,000           |
| Google Workspace Business + Gemini | ¥11,200         | ¥134,400           |
| Notion Team + AI                   | ¥8,250          | ¥99,000            |
| Slack Pro + 各種連携               | ¥5,400          | ¥64,800            |
| **本システム（自宅サーバー）**     | **¥500〜1,000** | **¥6,000〜12,000** |

**年間削減効果**: 約¥50,000〜¥260,000

---

## 10. リスクと対策

| リスク                | 影響             | 対策                                      |
| :-------------------- | :--------------- | :---------------------------------------- |
| 開発が続かない        | サービス未完成   | MVP優先、2週間で動くものを作る            |
| ローカルLLMの品質不足 | ユーザー体験低下 | API併用オプション、モデル更新追従         |
| セキュリティ脆弱性    | データ漏洩       | 依存関係の定期更新、Tailscale利用         |
| データ消失            | 業務影響         | 日次バックアップ + リモート同期           |
| 自宅サーバー障害      | サービス停止     | UPS導入、重要データのクラウドバックアップ |
| スケールの限界        | 成長できない     | PostgreSQL採用で将来の拡張に備える        |

---

## 11. 用語集

| 用語      | 説明                                                                                     |
| :-------- | :--------------------------------------------------------------------------------------- |
| RAG       | Retrieval-Augmented Generation。外部データを検索し、その結果を基にAIが回答を生成する手法 |
| Vector DB | テキストをベクトル（数値配列）に変換して保存し、意味的な類似検索を可能にするデータベース |
| LLM       | Large Language Model。大規模言語モデル。GPT-4、Claude、Llama等                           |
| Ollama    | ローカルでLLMを動かすためのツール。簡単にモデルをダウンロード・実行できる                |
| pgvector  | PostgreSQLにベクトル検索機能を追加する拡張機能                                           |
| Tailscale | WireGuardベースのVPNサービス。簡単にセキュアなネットワークを構築できる                   |
| TOTP      | Time-based One-Time Password。Google Authenticator等で使われる2要素認証方式              |

---

## 12. 参考資料

| リソース      | URL                                      |
| :------------ | :--------------------------------------- |
| FastAPI       | https://fastapi.tiangolo.com/            |
| React         | https://react.dev/                       |
| Magic UI      | https://magicui.design/                  |
| PostgreSQL    | https://www.postgresql.org/              |
| pgvector      | https://github.com/pgvector/pgvector     |
| Ollama        | https://ollama.ai/                       |
| Whisper.cpp   | https://github.com/ggerganov/whisper.cpp |
| Caddy         | https://caddyserver.com/                 |
| Tailscale     | https://tailscale.com/                   |
| Anthropic API | https://docs.anthropic.com/              |

---

## 13. 改訂履歴

| バージョン | 日付       | 変更内容                                                     |
| :--------- | :--------- | :----------------------------------------------------------- |
| 0.1        | 2024/XX/XX | 初版作成                                                     |
| 0.2        | 2024/XX/XX | エンタープライズ向け拡充                                     |
| 0.3        | 2024/XX/XX | 個人開発向けに技術スタックを無料/OSSベースに変更、機能は維持 |
